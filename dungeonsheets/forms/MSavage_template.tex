\documentclass[letterpaper,openany,oneside,twocolumn]{book}

\usepackage{fontspec}
\usepackage[justified]{dnd}
\usepackage{ifthen}
\usepackage{pstricks}

\usepackage[UKenglish]{babel}

\usepackage{dndtemplate}

\setlength\oddsidemargin{\dimexpr(\paperwidth-\textwidth)/2 - 1in\relax}
\setlength\evensidemargin{\oddsidemargin}

% Headline
\CharacterName{[[ char.name ]]}

% adds only main class and total level to prevent overflow
\Class{[[ char.primary_class.name ]] [[ char.level ]]} 
\Background{[[ char.background ]]}
\PlayerName{[[ char.player_name ]]}
\Race{[[ char.race ]]}
\Alignment{[[ char.alignment ]]}
\XP{[[ char.xp ]]}

% Ability scores
\StrengthScore{[[ char.strength.value ]]}
\DexterityScore{[[ char.dexterity.value ]]}
\ConstitutionScore{[[ char.constitution.value ]]}
\IntelligenceScore{[[ char.intelligence.value ]]}
\WisdomScore{[[ char.wisdom.value ]]}
\CharismaScore{[[ char.charisma.value ]]}

% Ability modifiers
\StrengthModifier{[[ char.strength.modifier ]]}
\DexterityModifier{[[ char.dexterity.modifier ]]}
\ConstitutionModifier{[[ char.constitution.modifier ]]}
\IntelligenceModifier{[[ char.intelligence.modifier ]]}
\WisdomModifier{[[ char.wisdom.modifier ]]}
\CharismaModifier{[[ char.charisma.modifier ]]}

% Saving Throws
\StrengthSavingThrowModifier{[[ char.strength.saving_throw ]]}
\DexteritySavingThrowModifier{[[ char.dexterity.saving_throw ]]}
\ConstitutionSavingThrowModifier{[[ char.constitution.saving_throw ]]}
\IntelligenceSavingThrowModifier{[[ char.intelligence.saving_throw ]]}
\WisdomSavingThrowModifier{[[ char.wisdom.saving_throw ]]}
\CharismaSavingThrowModifier{[[ char.charisma.saving_throw ]]}

\AcrobaticsSkillModifier{[[ char.acrobatics.modifier ]]}
\AnimalHandlingSkillModifier{[[ char.animal_handling.modifier ]]}
\ArcanaSkillModifier{[[ char.arcana.modifier ]]}
\AthleticsSkillModifier{[[ char.athletics.modifier ]]}
\DeceptionSkillModifier{[[ char.deception.modifier ]]}
\HistorySkillModifier{[[ char.history.modifier ]]}
\InsightSkillModifier{[[ char.insight.modifier ]]}
\IntimidationSkillModifier{[[ char.intimidation.modifier ]]}
\InvestigationSkillModifier{[[ char.investigation.modifier ]]}
\MedicineSkillModifier{[[ char.medicine.modifier ]]}
\NatureSkillModifier{[[ char.nature.modifier ]]}
\PerceptionSkillModifier{[[ char.perception.modifier ]]}
\PerformanceSkillModifier{[[ char.performance.modifier ]]}
\PersuasionSkillModifier{[[ char.persuasion.modifier ]]}
\ReligionSkillModifier{[[ char.religion.modifier ]]}
\SleightOfHandSkillModifier{[[ char.sleight_of_hand.modifier ]]}
\StealthSkillModifier{[[ char.stealth.modifier ]]}
\SurvivalSkillModifier{[[ char.survival.modifier ]]}

% Proficiencies
\SetStrengthProficiency{[% if "strength" in char.saving_throw_proficiencies %]1[% else %]0[% endif %]}
\SetDexterityProficiency{[% if "dexterity" in char.saving_throw_proficiencies %]1[% else %]0[% endif %]}
\SetConstitutionProficiency{[% if "constitution" in char.saving_throw_proficiencies %]1[% else %]0[% endif %]}
\SetIntelligenceProficiency{[% if "intelligence" in char.saving_throw_proficiencies %]1[% else %]0[% endif %]}
\SetWisdomProficiency{[% if "wisdom" in char.saving_throw_proficiencies %]1[% else %]0[% endif %]}
\SetCharismaProficiency{[% if "charisma" in char.saving_throw_proficiencies %]1[% else %]0[% endif %]}

\SetAcrobaticsProficiency{[% if "acrobatics" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetAnimalHandlingProficiency{[% if "animal handling" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetArcanaProficiency{[% if "arcana" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetAthleticsProficiency{[% if "athletics" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetDeceptionProficiency{[% if "deception" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetHistoryProficiency{[% if "history" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetInsightProficiency{[% if "insight" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetIntimidationProficiency{[% if "intimidation" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetInvestigationProficiency{[% if "investigation" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetMedicineProficiency{[% if "medicine" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetNatureProficiency{[% if "nature" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetPerceptionProficiency{[% if "perception" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetPerformanceProficiency{[% if "performance" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetPersuasionProficiency{[% if "persuasion" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetReligionProficiency{[% if "religion" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetSleightOfHandProficiency{[% if "sleight of hand" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetStealthProficiency{[% if "stealth" in char.skill_proficiencies %]1[% else %]0[% endif %]}
\SetSurvivalProficiency{[% if "survival" in char.skill_proficiencies %]1[% else %]0[% endif %]}

\Inspiration{[% if char.inspiration %] $\star$ [% endif %]}
\Proficiency{[[ char.proficiency_bonus ]]}
\Perception{[[ 10 + char.perception.modifier ]]} 

\ArmorClass{[[ char.armor_class ]]}
\Initiative{[[ char.initiative.replace("+", "") ]]}
\Speed{[[ char.speed ]]}
\MaxHitPoints{[[ char.hp_max ]]}
[% if char.hp_current %]\CurrentHitPoints{[[ char.hp_current ]]}[% endif %]
[% if char.hp_temp %]\TemporaryHitPoints{[[ char.hp_temp ]]}[% endif %]
\MaxHitDice{[[ char.hit_dice.replace(" ","") ]]}
\CurrentHitDice{[[ char.hit_dice_current.replace(" ", "") ]]}

\CP{[% if char.cp > 0 %][[ char.cp ]][% endif %]}
\SP{[% if char.sp > 0 %][[ char.sp ]][% endif %]}
\GP{[% if char.gp > 0 %][[ char.gp ]][% endif %]}
\EP{[% if char.ep > 0 %][[ char.ep ]][% endif %]}
\PP{[% if char.pp > 0 %][[ char.pp ]][% endif %]}

[% for w in char.weapons %]
\AddWeapon{[[ w.name ]]}{[[ "{:+d}".format(w.attack_modifier) ]]}{[[ "{}/{}".format(w.damage, w.damage_type) ]]}
[% endfor %]

\AttacksAdditional{[%- if char.armor -%]\textbf{Armor}: [[ char.armor ]] \\ [%endif %]
                   [%- if char.shield -%]\textbf{Shield}: [[ char.shield ]] \\ [%endif %]
                   [[- char.attacks_and_spellcasting| boxed -]]}

\OtherProficienciesLanguages{\textbf{Languages:} [[ char.languages ]]. \\
[%- for prof_type, values in char.proficiencies_by_type.items() %]
  [%- if not values == "": %]
\textbf{[[ prof_type ]]}: [[ values ]]. \\
  [%- endif -%]
[%- endfor -%]
}

\Equipment{[[ char.equipment_text| boxed ]]}

\PersonalityTraits{[[ char.personality_traits ]]}

\Ideals{[[ char.ideals ]]}

\Bonds{[[ char.bonds ]]}

\Flaws{[[ char.flaws ]]}

\FeaturesTraits{[[ char.features_summary| boxed ]]}


% Appearance

\Age{[[ char.age ]]}
\Height{[[ char.height ]]}
\Weight{[[ char.weight ]]}
\Eyes{[[ char.eyes ]]}
\Skin{[[ char.skin ]]}
\Hair{[[ char.hair ]]}

% background

\CharacterAppearance{[[ portrait ]]
[[ char.appearance_text ]]
}
\AdditionalFeaturesAndTraits{[[ char.additional_description ]]}

\Characterbackground{[[ char.backstory ]] }

\Treasure{[[ char.treasure ]]}

\AlliesAndOrganizations{[[ char.allies ]]}

\OrganizationName{[[ char.org_name ]]}

[% if char.is_spellcaster %]
%Magic
[[ char | spellsheetparser ]]
[% endif %]


\begin{document}
\newgeometry{left=0cm,right=0cm,top=0cm,bottom=0cm}
\onecolumn


% CHARACTER PAGE
\rendercharactersheet

% BACKSTORY PAGE
\renderbackgroundsheet

[% if char.is_spellcaster %]
% SPELLCASTING PAGE
\renderspellsheet
[% endif %]

\end{document}
